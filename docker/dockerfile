# Этап сборки фронтенда
FROM node:18-alpine as frontend-builder

WORKDIR /app

# 1. Сначала копируем только package.json
COPY package.json ./

# 2. Явно устанавливаем tailwindcss и зависимости
RUN npm install tailwindcss postcss autoprefixer --save-dev

# 3. Копируем конфигурационные файлы
COPY tailwind.config.js ./
COPY src/main/resources/static/css/tailwind.css ./css/

# 4. Запускаем сборку CSS
RUN npx tailwindcss -i ./css/tailwind.css -o ./css/output.css --minify

# Остальная часть Dockerfile остается без изменений
FROM maven:3.8.6-eclipse-temurin-17-alpine as backend-builder
WORKDIR /app
COPY . .
COPY --from=frontend-builder /app/css/output.css /app/src/main/resources/static/css/
RUN mvn clean package -DskipTests

FROM eclipse-temurin:21-jre-alpine
WORKDIR /app
COPY --from=backend-builder /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]